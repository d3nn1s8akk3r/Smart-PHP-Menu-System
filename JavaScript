<script>
function updateActiveSection() {
    const sections = document.querySelectorAll('section[id^="menu_"]');
    let current = '';

    sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        if (rect.top >= -100 && rect.top < window.innerHeight * 0.4) {
            current = section.id;
        }
    });

    if (current) {
        if (window.location.hash !== '#' + current) {
            history.replaceState(null, null, '#' + current);
        }
        document.cookie = `active_section=${current}; path=/; SameSite=Lax`;
    }
}

window.addEventListener('scroll', updateActiveSection);
window.addEventListener('load', updateActiveSection);
document.querySelectorAll('.site-menu a').forEach(link => {
    link.addEventListener('click', () => setTimeout(updateActiveSection, 100));
});
</script>
